# Colibri SDK

The Colibri SDK is a package that contains the entire Colibri persistence layer. It connects directly to the Colibri
database and exposes functions to interact with all records in it. It is used by Colibri itself but may also serve as
the foundation of third-party applications that want to interact with Colibri's data.

## Installation

Install the package from npm:

```bash
pnpm install @colibri-hq/sdk
```

## Get started

The SDK exports a factory function that returns a connection to the database. Start by creating a connection:

```typescript
import { initialize } from "@colibri-hq/sdk";

const connection = initialize("postgres://user@database:5423/colibri");
```

The connection is a [Kysely instance](https://kysely.dev/), a type-safe query builder pre-configured for the Colibri
database. You can use it to run direct SQL queries, if necessary:

```typescript
const result = await connection
  .selectFrom("books")
  .selectAll()
  .where("id", "=", 42)
  .executeTakeFirst();
```

## Convenience functions

The SDK also exports a set of convenience functions that wrap the queries used to interact with the database. These
functions are designed to be used with the connection created by the `initialize` function. They provide a higher-level
interface for common operations, making it easier to work with the database without having to write SQL queries
manually; using them is recommended.

You can import these functions individually. For example, to get all books:

```typescript
import { loadBooks } from "@colibri-hq/sdk";

const books = await loadBooks(connection, "search term");
```

## Database Schema

The current database schema types (generated by [`kysely-codegen`](https://github.com/RobinBlomberg/kysely-codegen))
are exported from the SDK:

```typescript
import type { DB } from "@colibri-hq/sdk/schema";

type Book = DB["books"];
```

## OAuth

In addition to the database connection, the SDK also provides factories for the OAuth client and server. While the
latter is primarily useful for Colibri itself, the OAuth client allows authenticating users in third-party integrations.

```typescript
import { client } from "@colibri-hq/sdk/oauth";

const oauth = client({ clientId: "your-client-id", clientSecret: "your-client-secret" });

const { accessToken } = await oauth.authorize();
```

## Storage

The SDK provides a storage client that can be used to work with Colibri's persistent file storage. This client is pretty
much just a pre-configured S3 client, along with a few convenience functions. It is used by Colibri itself, but can also
be used in third-party applications that need to work with the files of a Colibri instance.

```typescript
import { client } from '@colibri-hq/sdk/storage';

const client = storage({
  endpoint: 'https://storage.example.com',
  region: 'eu-west-1',
  accessKeyId: 'your-access-key-id',
  secretAccessKey: 'your-secret-access-key',
```
